sudo: false

language: java
jdk:
  - oraclejdk8

cache:
    directories:
        - $HOME/.m2
        - $HOME/apache-maven-3.3.9

before_script:
    - base64 -d <<< $MAVEN_DEPLOY_SETTINGS | tar -xz -C $HOME

script:
    - rm -rf $HOME/.m2/repository/com/alvexcore
    - scripts/mvn.sh -f utils/repo/pom.xml clean package
    - scripts/mvn.sh -f utils/repo/pom.xml clean package -P make-jar
    - scripts/mvn.sh -f utils/share/pom.xml clean package
    - scripts/mvn.sh -f utils/share/pom.xml clean package -P make-jar
    - scripts/run_integration_tests.sh repo utils/ scripts/
    - scripts/run_integration_tests.sh share utils/ scripts/

after_success:
    - scripts/mvn.sh -f utils/repo/pom.xml deploy -P make-jar
    - scripts/mvn.sh -f utils/share/pom.xml deploy -P make-jar

notifications:
  email:
    recipients:
      - alvex-build@itdhq.com
    on_success: change
    on_failure: always
